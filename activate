# @Izzulmakin 2015
# must be used by calling "source activate" (from bash), from root project dir
# you cannot run it directly
# adapted from python virtualenv

if ! [ -f "activate" ] ; then
	echo "source activate must be run on project directory"
	echo "cd to project directory then 'source activate'"
else
	if [ -n "$_INSPENSE_VENV" ] ; then
		echo "reactivate"
		deactivate
	fi

	_INSPENSE_VENV="$PWD"
	export _INSPENSE_VENV

	_OLD_PATH="$PATH"
	PATH="$PATH:$PWD/node_modules/.bin"
	export PATH

	_OLD_PS1="$PS1"
	PS1="(Inspens) $PS1"
	export PS1

	echo "Env set. Deactivate this env by call 'deactivate'"
	echo "Installed modules: "
	ls node_modules/.bin/

	deactivate () {
		if [ -n "$_INSPENSE_VENV" ] ; then
			unset _INSPENSE_VENV
		fi
		if [ -n "$_OLD_PATH" ] ; then
			PATH="$_OLD_PATH"
			export PATH
			unset _OLD_PATH
		fi
		if [ -n "$_OLD_PS1" ] ; then
			PS1="$_OLD_PS1"
			export PS1
			unset _OLD_PS1
		fi
		unset -f deactivate
	}

	# This should detect bash and zsh, which have a hash command that must
	# be called to get it to forget past commands.  Without forgetting
	# past commands the $PATH changes we made may not be respected
	if [ -n "$BASH" -o -n "$ZSH_VERSION" ] ; then
		hash -r 2>/dev/null
	fi
fi
